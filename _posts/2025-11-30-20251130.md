---
layout: post
title: "DELL R730 服务器安装 AMD 显卡风扇狂转问题"
tags: ["Windows", "GCC", "服务器"]
---

在某些情况下，当在DELL 730服务器上测试新到的不支持的PCIE设备时，开机后风扇狂转，尽管 CPU 和主板温度正常。这通常是由于未被服务器认证的 PCIE 设备导致的。为了解决这个问题，我们可以通过调整服务器的 IPMI 配置来禁用第三方 PCIe 卡的风扇响应，从而降低风扇转速。

## 前提条件

1. 需要具备 **root** 或管理员权限。
2. 服务器上已安装 IPMI Tools（如果没有安装，请参见下面的安装步骤）。
3. 需要配置 iDRAC 访问权限（对于 Windows 系统）。

## 解决方法

### 安装 IPMI Tools

#### Linux 系统

在 Linux 系统上，首先需要安装 OpenIPMI 和 IPMI-tools。

执行以下命令：

```bash
# 安装 OpenIPMI 和 IPMI-tools
yum install OpenIPMI OpenIPMI-tools

# 可选：设置 IPMI 在启动时自动运行
chkconfig ipmi on

# 可选：手动启动 IPMI 服务
service ipmi start
```

#### Windows 系统

在 Windows 系统上，你需要安装 Dell EMC iDRAC 工具包。你可以从 Dell 官方网站下载并安装 [Dell EMC iDRAC Tools for Microsoft Windows Server®](https://www.dell.com/support/home)（版本 v9.4.0）。

1. 下载并安装 iDRAC 工具。
2. 确保你的 Windows 服务器可以连接到 iDRAC 控制台。

### 查询系统默认针对第三方 PCIe 设备的风扇配置

通过 `ipmitool` 查询当前的风扇配置，确定是否已经禁用了对第三方 PCIe 设备的响应。

#### Linux 查询命令

执行以下命令来查询系统默认针对第三方 PCIe 设备的风扇配置：

```bash
ipmitool raw 0x30 0xce 0x01 0x16 0x05 0x00 0x00 0x00
```

#### Windows 查询命令

如果你使用的是 Windows 系统，可以通过以下命令查询风扇配置：

```bash
ipmitool.exe –I lanplus -H <iDRAC’s IP> -U <User Name> -P <Password> raw 0x30 0xce 0x01 0x16 0x05 0x00 0x00 0x00
```

#### 解释响应

- **Disabled (禁用)**： 如果响应如下，表示风扇响应已经被禁用。

  ```bash
  16 05 00 00 00 05 00 01 00 00
  ```

- **Enabled (启用)**： 如果响应如下，表示风扇响应处于启用状态。

  ```bash
  16 05 00 00 00 05 00 00 00 00
  ```

### 关闭第三方 PCIe 卡的响应

如果系统默认启用了风扇响应，我们可以通过 IPMI 工具来关闭第三方 PCIe 卡的风扇响应。

#### Linux 关闭响应命令

执行以下命令来关闭第三方 PCIe 卡的风扇响应：

```bash
ipmitool raw 0x30 0xce 0x00 0x16 0x05 0x00 0x00 0x00 0x05 0x00 0x01 0x00 0x00
```

#### Windows 关闭响应命令

如果你在 Windows 系统上操作，请使用以下命令：

```bash
ipmitool.exe –I lanplus -H <iDRAC’s IP> -U <User Name> -P <Password> raw 0x30 0xce 0x00 0x16 0x05 0x00 0x00 0x00 0x05 0x00 0x01 0x00 0x00
```

### 打开第三方 PCIe 卡的响应

如果你需要重新启用风扇响应，可以使用以下命令。

#### Linux 打开响应命令

执行以下命令来启用风扇响应：

```bash
ipmitool raw 0x30 0xce 0x00 0x16 0x05 0x00 0x00 0x00 0x05 0x00 0x00 0x00 0x00
```

#### Windows 打开响应命令

在 Windows 系统上执行以下命令来启用响应：

```bash
ipmitool.exe –I lanplus -H <iDRAC’s IP> -U <User Name> -P <Password> raw 0x30 0xce 0x00 0x16 0x05 0x00 0x00 0x00 0x05 0x00 0x00 0x00 0x00
```

### 验证配置

在完成修改后，可以重新运行查询命令，验证风扇响应是否已经成功关闭或启用。

```bash
ipmitool raw 0x30 0xce 0x01 0x16 0x05 0x00 0x00 0x00
```

如果系统响应为禁用状态（`00 00`），说明操作成功。

## 注意事项

1. 进行这些操作时，确保 iDRAC 控制台已正确配置，并且能通过 IP 进行远程访问。
2. 确保操作过程中系统不会突然关机或重启，以免影响硬件配置的稳定性。
3. 在 Windows 系统中，`ipmitool.exe` 需要正确配置 iDRAC 的 IP 地址以及管理员凭证。
